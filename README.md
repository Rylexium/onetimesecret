# Полная функциональность скрипта для One-Time Secret Sharing Application

Это приложение представляет собой веб-сервис для безопасного обмена одноразовыми секретами с веб-интерфейсом и REST API.

## Основные функции

### 1. Веб-интерфейс
- **Главная страница (`/`)**: Позволяет пользователям:
  - Вводить секретный текст в форму
  - Получать уникальную ссылку для доступа к секрету
  - Видеть сообщения об ошибках (если текст пустой)

- **Страница просмотра секрета (`/share/<secret_id>`)**: 
  - Отображает секретный текст однократно
  - Автоматически удаляет секрет после просмотра
  - Показывает время истечения срока действия секрета
  - Отображает ошибки, если секрет не найден или истек

### 2. REST API (использует Flask-RESTX)
- **Создание секрета (`POST /api/v1/secrets/create`)**:
  - Принимает JSON с текстом секрета и временем жизни (TTL)
  - Возвращает ID секрета, URL для доступа и время истечения
  - Шифрует текст перед сохранением

- **Получение секрета (`GET /api/v1/secrets/get/<secret_id>`)**: 
  - Возвращает расшифрованный текст секрета
  - Удаляет секрет после однократного просмотра
  - Возвращает ошибку 404, если секрет не найден

### 3. Безопасность и шифрование
- **Шифрование данных**:
  - Использует Fernet (симметричное шифрование) из библиотеки cryptography
  - Ключ шифрования хранится в отдельном файле с ограниченными правами доступа
  - Автоматически генерирует ключ при первом запуске, если он не существует

- **База данных**:
  - SQLite с таблицей `secrets` для хранения зашифрованных данных
  - Автоматическое удаление просроченных секретов
  - Индексы для ускорения поиска по сроку действия

### 4. Управление данными
- **Хранение данных**:
  - Все данные хранятся в `/var/lib/secret_app/`
  - База данных: `secrets.db`
  - Ключ шифрования: `secret.key`

- **Инициализация**:
  - Автоматическое создание необходимых директорий и файлов
  - Настройка правильных прав доступа к файлам (0600 для ключа, 0660 для БД)

### 5. Дополнительные функции
- **Статические файлы**: Обслуживание CSS, JS и других статических ресурсов из `/static/`
- **Логирование**: Запись ошибок в лог приложения
- **Отладка**: Вывод информации о конфигурации и зарегистрированных маршрутах при запуске

## Технические детали реализации

1. **Шифрование**:
   - Все секреты шифруются перед сохранением в БД
   - Используется AES в режиме CBC с 128-битным ключом (Fernet)
   - Ключ сохраняется в отдельном файле с ограниченными правами

2. **База данных**:
   - Схема: `id (TEXT PK)`, `encrypted_data (TEXT)`, `expires_at (TIMESTAMP)`, `is_encrypted (BOOLEAN)`
   - Автоматическая очистка просроченных записей при инициализации
   - Поддержка типов данных datetime через адаптеры SQLite

3. **Веб-интерфейс**:
   - Шаблоны HTML хранятся в `/templates/`
   - Статические файлы в `/static/`
   - Обработка ошибок с пользовательскими страницами

4. **API**:
   - Документирование через Swagger UI (доступно по `/api/docs/`)
   - Валидация входных данных
   - Стандартные HTTP коды ответов

5. **Развертывание**:
   - Запускается на 0.0.0.0:5000
   - Автоматическая перезагрузка шаблонов в режиме разработки
   - Проверка существования необходимых директорий при запуске

## Поток данных

1. **Создание секрета**:
   - Пользователь вводит текст → шифрование → сохранение в БД → генерация URL

2. **Просмотр секрета**:
   - Запрос по URL → поиск в БД → расшифровка → удаление записи → показ текста

3. **Очистка**:
   - При инициализации приложения автоматически удаляются все просроченные секреты

## Безопасность

- Одноразовый доступ к секретам (удаление после просмотра)
- Шифрование всех данных перед сохранением
- Ограниченные права доступа к критическим файлам
- Генерация криптографически безопасных идентификаторов

Приложение предоставляет простой и безопасный способ обмена конфиденциальной информацией с гарантией одноразового доступа.
